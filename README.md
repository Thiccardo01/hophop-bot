# Hop Hop Super-Resolutions Bot

A complete production-ready Instagram Chatbot for the "Hop Hop Super-Resolutions" campaign.

## Architecture
See [architecture_diagram.md](architecture_diagram.md) for a visual overview.
The system consists of:
- **Backend**: Node.js/Express app handling Webhooks from ManyChat and LLM logic.
- **Database**: PostgreSQL (with `pgvector` extension) for user profiles, session history, and vector memory.
- **Cache**: Redis for fast session retrieval.

## System Prompt & AI Behavior
The bot's personality, rules, and conversation flow are defined in a **fully editable** markdown file:
- üìç **[src/prompts/system-prompt.md](src/prompts/system-prompt.md)**

Edit this file to change how the bot speaks, roasts users, or enforces safety rules. Changes require a server restart.

## API Documentation

### ManyChat Webhook
**POST /api/webhook/manychat**
Handles incoming messages from ManyChat.

**Request Body:**
```json
{
  "subscriber_id": "string (required)",
  "contact_info": { "first_name": "string", "ig_handle": "string" },
  "trigger": "string",
  "message": "string"
}
```

**Response:**
```json
{
  "reply": "Text response generated by LLM",
  "quick_replies": ["Option 1", "Option 2"],
  "metadata": { "session_id": "uuid" }
}
```



## Operational Guide

### Monitoring & Logs
- Logs are written to `logs/combined.log`.
- In production (Render), view logs via the Render Dashboard.
- **Sentry**: Set `SENTRY_DSN` in env vars to enable error tracking.

### Scaling
- **LLM Costs**: Monitor OpenAI usage. The system uses `gpt-4o` by default. Switch to `gpt-3.5-turbo` in env vars to save costs.
- **Database**: `pgvector` allows for scalable memory.

### Incident Response
- **Bot going rogue**: Revoke `OPENAI_API_KEY` immediately.
- **Update Safety Rules**: Edit `src/prompts/system-prompt.md`.

## Setup & Local Development

### Prerequisites
- Node.js 18+
- Docker & Docker Compose
- Environment file `.env` (copy from `.env.example`)

### Quick Start
1.  Clone the repo.
2.  Copy `.env.example` to `.env` and fill in secrets.
3.  Install dependencies:
    ```bash
    npm install
4.  Run database and redis locally via Docker:
    ```bash
    docker-compose up -d
    ```
5.  Initialize DB:
    ```bash
    npx prisma generate
    npx prisma db push
    ```
6.  Start Backend: `npm run dev`

## Deployment
See [GETTING_STARTED.md](GETTING_STARTED.md) for a comprehensive step-by-step deployment guide for Render, PostgreSQL, and ManyChat.

## Testing
- Run integration test: `npx ts-node scripts/simulate_flow.ts`
- Run unit tests: `npm test`
